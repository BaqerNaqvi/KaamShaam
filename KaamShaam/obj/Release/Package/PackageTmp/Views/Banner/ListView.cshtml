
@model List<KaamShaam.AdminModels.BannerModel>
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}


<style>
    .bannerDiv {
        margin-top: 7%;
    }
</style>
<div id="page-wrapper">
    <div class="container-fluid">

        <div class="page-header">
            <h1>Banners</h1>
        </div>
        <div>
            <input type="button" class="btn btn-primary" style="margin-bottom: 9px; float: right;" data-toggle="modal" data-target="#bannerModal" value="New Banner">
        </div>
        @{
            string baseUrl = Request.Url.Scheme + "://" + Request.Url.Authority +
                                    Request.ApplicationPath.TrimEnd('/') + "/Images/Banners/";
        }



        @foreach (var item in Model)
        {
            var img = baseUrl + item.FileName;
            var heading = "";
            heading = item.Status ? "Suspend" : "Resume";
            <div class="bannerDiv">
                <div>
                    <img class="img-thumbnail" src="@img" alt="" style="height:600px; width: 1600px">
                </div>
                <div>
                    <button class="btn btn-warning" style=";margin-left: 12px;float: right; margin-top: 12px;" onclick="SuspendBanner(@Json.Encode(item))">@heading</button>
                    <button class="btn btn-danger" style=";margin-left: 12px;float: right; margin-top: 12px;" onclick="DeleteBanner(@Json.Encode(item))">Delete</button>
                    <select id="ord_@item.Id" onchange="orderchnaged(@Json.Encode(item))" class="form-control" style="margin-top: 12px;display: inline-block;width: 7%;margin-left: 12px;float: right;">
                        @for (var i = 0; i < Model.Count; i++)
                        {
                            var valtoshow=(i+1);
                            var sel = "";
                            if (valtoshow == item.ShowOrder)
                            {
                                sel = "selected";
                            }
                            <option @sel value="@valtoshow">@valtoshow</option>
                        }
                    </select>
                </div>
            </div>
        }


    </div>
    <!-- /.container-fluid -->
</div>

<!-- line modal -->
<div class="modal fade" id="bannerModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <h3 class="modal-title" id="lineModalLabel">Banner</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <form id="uploadBannerForm">
                        <label for="uploadBannerFile"> &nbsp;</label>
                        <input id="uploadBannerFile" multiple type="file" class="btn btn-primary" style="margin-bottom: 9px; float: left;" value="Upload Banner">
                        <input type="submit" class="btn btn-primary" value="Upload file" />
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>
<script src="~/Scripts/jquery.js"></script>
<script>
    $("#banner-li").addClass('active');
    $('#uploadBannerForm').submit(function() {

        var formdata = new FormData(); //FormData object
        var fileInput = document.getElementById('uploadBannerFile');
        //Iterating through each files selected in fileInput
        for (i = 0; i < fileInput.files.length; i++) {
            //Appending each file to FormData object
            formdata.append(fileInput.files[i].name, fileInput.files[i]);
        }
        //Creating an XMLHttpRequest and sending
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/Banner/Upload');
        xhr.send(formdata);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                toastr.success('Banner(s) uploaded');
                setTimeout(function() {
                    location.reload();
                },1000);
            }
        }
        return false;
    });

    function DeleteBanner(obj) {
        $.ajax({
            url: 'DeleteBanner',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(obj),
            success: function (data) {
                toastr.success("Banner deleted");
                setTimeout(function() {
                    location.reload();
                },1000);
            },
            error: function (data) { }
        });
    }

    function SuspendBanner(obj) {
        obj.Status = !obj.Status;
        $.ajax({
            url: 'EditBanner',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(obj),
            success: function (data) {
                toastr.success("Banner updated");
                setTimeout(function() {
                    location.reload();
                },1000);
            },
            error: function (data) { }
        }); 
    }
    function orderchnaged(obj) {
        var id = "ord_" + obj.Id;
        obj.ShowOrder=$('#' + id).val();
        $.ajax({
            url: 'EditBanner',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(obj),
            success: function (data) {
                toastr.success("Banner updated");
                setTimeout(function() {
                    location.reload();
                },1000);
            },
            error: function (data) { }
        });  
    }
</script>